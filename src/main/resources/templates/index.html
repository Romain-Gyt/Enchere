<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/layout :: layout(
            pageContent=~{:: .main-content},
            pageTitle=~{:: title},
            additionalCss=~{},
            additionalJs=~{}
        )}">
<head>
    <title th:text="Accueil">Home</title>
    <script src="/js/Filter_home.js"></script>
</head>
<body>
<main class="main-content">
    <div class="container">
        <h1 class="text-center">Liste des enchères</h1>

        <form action="/" method="GET">
            <div class="row my-3">
                <div class="col-md-6">
                    <input type="text" class="form-control" name="searchInput" placeholder="Recherche...">
                </div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary float-right btn-form">Rechercher</button>
                </div>
            </div>
        </form>

        <div class="row">
            <form action="/category" method="GET">
                <div class="row">
                    <div class="col-md-6">
                        <select class="form-control" id="categorySelect" name="category_id">
                            <option value=""  selected>---- Catégories ----</option>
<!--                             Boucle pour afficher les libellés des catégories -->
                            <option th:each="category : ${categories}"  th:value="${category.categoryId}" th:text="${category.label}"></option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary btn-form">Filtrer</button>
                    </div>
                </div>
            </form>


        </div>

        <div class="row auctions-container">
            <div class="col-md-6" th:each="article : ${articles}">
                <div class="card mb-3  bg-dark ">
                    <div class="row no-gutters">
                        <div class="col-md-4">
                            <img th:src="@{${'/images/' + article.itemId + '.jpg'}}"
                                 onerror="this.onerror=null; this.src='/images/enchere.jpg';"
                                 class="card-img"
                                 alt="Image par défaut">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <th:block th:if="${#authorization.expression('isAuthenticated()')}">
                                    <a th:href="@{/article/detail/{id}(id=${article.itemId})}">
                                        <h5 class="card-title text-white font-weight-bold" th:text="${article.itemName}"></h5>
                                    </a>
                                </th:block>
                                <h5 class="card-title text-white font-weight-bold" th:unless="${#authorization.expression('isAuthenticated()')}" th:text="${article.itemName}"></h5>
                                <div th:if="${article.auctions.size() > 0}">
                                    Prix : <span th:text="${article.auctions.get(article.auctions.size() - 1).getBidAmount()}"></span>
                                </div>
                                <div th:unless="${article.auctions.size() > 0}">
                                    Prix : <span th:text="${article.initialPrice}"></span>
                                </div>

                                <p class="card-text text-white">Date de début de l'enchère : <span th:text="${#dates.format(article.startAuctionDate, 'dd/MM/yyyy')}"></span></p>
                                <p class="card-text text-white">Date de fin de l'enchère : <span th:text="${#dates.format(article.endAuctionDate, 'dd/MM/yyyy')}"></span></p>
                                <p class="card-text text-white">Vendu par : <span th:text="${article.user.getPseudo()}"></span></p>
                                <p class="card-text text-white">Catégorie : <span th:text="${article.category.getLabel()}"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>
